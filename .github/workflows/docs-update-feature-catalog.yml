name: Update feature catalog page
on:
  schedule:
    - cron: 0 10 * * MON
  workflow_dispatch:
jobs:
  generate-feature-catalog-file:
    name: Generate feature catalog file
    runs-on: ubuntu-latest
    steps:
      - name: Checkout docs repository
        uses: actions/checkout@v4
        with:
          repository: 'localstack/docs'

      - name: Download features files from Collect feature files (GitHub)
        uses: actions/download-artifact@v4
        with:
          path: features-files-community
          name: features-files
          repository: localstack/localstack

      - name: Download features files from Collect feature files from PRO (GitHub)
        uses: actions/download-artifact@v4
        with:
          path: features-files-ext
          name: features-files-ext
          repository: localstack/localstack
          github-token: ${{ secrets.GH_AC_UPDATE_FEATURE_CATALOG }}

      - name: Generate feature catalog page
        run: python3 scripts/generate_feature_catalog_page.py
        env:
          PATH_FEATURE_FILES_COMMUNITY: 'features-files-community'
          PATH_FEATURE_FILES_EXT: 'features-files-ext'
          PATH_FEATURE_CATALOG_MD: 'content/en/user-guide/aws/feature-coverage.md'

      - name: Create PR
        uses: peter-evans/create-pull-request@v7
        with:
          title: "Update Feature catalog page"
          body: "This PR updates Feature catalog page based on feature catalog YAML files"
          branch: "update-feature-catalog"
          add-paths: 'content/en/user-guide/aws/feature-coverage.md'
          author: "LocalStack Bot <localstack-bot@users.noreply.github.com>"
          committer: "LocalStack Bot <localstack-bot@users.noreply.github.com>"
          commit-message: "Upgrade feature catalog"
          labels: "documentation"
